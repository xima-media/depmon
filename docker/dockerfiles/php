FROM php:7.2-fpm

MAINTAINER XIMA MEDIA GmbH <opensource@xima.de>

#
# Benötigte Pakete installieren
#
RUN apt-get update \
 && DEBIAN_FRONTEND=noninteractive apt-get install -y \
    git \
    libfreetype6-dev \
    libgd-dev \
    libicu-dev \
    libjpeg62-turbo-dev \
    libzip-dev \
    locales \
 && rm -rf /var/lib/apt/lists/*

RUN apt-get update -y \
  && apt-get install -y \
    libxml2-dev \
  && apt-get clean -y \
  && docker-php-ext-install soap

#
# PHP Core Extensions konfigurieren & installieren
#
RUN docker-php-ext-configure pdo_mysql --with-pdo-mysql=mysqlnd \
 && docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \
 && docker-php-ext-install -j$(nproc) \
    gd \
    intl \
    opcache \
    pdo_mysql \
    zip

#
# PECL Extensions installieren
#
# RUN pecl install xdebug-2.5.0 \
#  && docker-php-ext-enable \
#     xdebug

# RUN pecl install apcu-4.0.11 \
#     && echo extension=apcu.so > /usr/local/etc/php/conf.d/apcu.ini

#
# User developer
#
RUN adduser developer --disabled-password --uid 1000 \
 && adduser developer www-data

#
# Install composer
#
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
RUN mkdir /home/developer/.composer \
    && chmod -R 777 /home/developer/.composer

#
# Benötigte Verzeichnisse erstellen
#
RUN mkdir \
    /.composer \
    /.cache \
 && chmod 777 \
    /.composer/ \
    /.cache/

#
# German locales
#
RUN sed -i -e 's/# de_DE.UTF-8 UTF-8/de_DE.UTF-8 UTF-8/' /etc/locale.gen \
 && echo 'LANG="de_DE.UTF-8"' > /etc/default/locale \
 && dpkg-reconfigure --frontend=noninteractive locales \
 && update-locale LANG=de_DE.UTF-8

ENV LANG de_DE.UTF-8
